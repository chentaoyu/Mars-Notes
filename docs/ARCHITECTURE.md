# Mars-Notes - æŠ€æœ¯æ¶æ„è®¾è®¡æ–‡æ¡£

## æ–‡æ¡£ä¿¡æ¯

- **é¡¹ç›®åç§°**: Mars-Notes
- **æ¶æ„ç‰ˆæœ¬**: v1.2
- **æ–‡æ¡£ç‰ˆæœ¬**: 1.2.1
- **åˆ›å»ºæ—¥æœŸ**: 2025-11-04
- **æœ€åæ›´æ–°**: 2025-01-27

---

## ç›®å½•

1. [ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ](#1-ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ)
2. [æŠ€æœ¯æ ˆè¯¦è§£](#2-æŠ€æœ¯æ ˆè¯¦è§£)
3. [é¡¹ç›®ç›®å½•ç»“æ„](#3-é¡¹ç›®ç›®å½•ç»“æ„)
4. [æ ¸å¿ƒæ¨¡å—è®¾è®¡](#4-æ ¸å¿ƒæ¨¡å—è®¾è®¡)
5. [æ•°æ®æµè®¾è®¡](#5-æ•°æ®æµè®¾è®¡)
6. [å®‰å…¨æ¶æ„](#6-å®‰å…¨æ¶æ„)
7. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#7-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
8. [éƒ¨ç½²æ¶æ„](#8-éƒ¨ç½²æ¶æ„)

---

## 1. ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

### 1.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·æµè§ˆå™¨                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ç™»å½•é¡µ   â”‚  â”‚  æ³¨å†Œé¡µ   â”‚  â”‚  ç¬”è®°åˆ—è¡¨  â”‚  â”‚ ç¼–è¾‘å™¨é¡µ â”‚ â”‚
â”‚  â”‚           â”‚  â”‚           â”‚  â”‚ ç¬”è®°æœ¬åˆ—è¡¨ â”‚  â”‚ æ ‡ç­¾ç®¡ç† â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ HTTPS
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Next.js åº”ç”¨å±‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              å‰ç«¯å±‚ (React Components)                â”‚   â”‚
â”‚  â”‚  â€¢ UI ç»„ä»¶ (Tailwind CSS)                            â”‚   â”‚
â”‚  â”‚  â€¢ é¡µé¢ç»„ä»¶ (App Router)                             â”‚   â”‚
â”‚  â”‚  â€¢ å®¢æˆ·ç«¯é€»è¾‘ (Hooks, Context)                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                             â”‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              åç«¯å±‚ (API Routes / Route Handlers)     â”‚   â”‚
â”‚  â”‚  â€¢ è®¤è¯ API (/api/auth/*)                            â”‚   â”‚
â”‚  â”‚  â€¢ ç¬”è®° API (/api/notes/*)                           â”‚   â”‚
â”‚  â”‚  â€¢ ç¬”è®°æœ¬ API (/api/notebooks/*)                     â”‚   â”‚
â”‚  â”‚  â€¢ æ ‡ç­¾ API (/api/tags/*)                            â”‚   â”‚
â”‚  â”‚  â€¢ ç”¨æˆ·ç®¡ç† API (/api/user/*)                        â”‚   â”‚
â”‚  â”‚  â€¢ ä¸­é—´ä»¶ (è®¤è¯ã€é”™è¯¯å¤„ç†)                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                             â”‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              æ•°æ®è®¿é—®å±‚ (Prisma ORM)                  â”‚   â”‚
â”‚  â”‚  â€¢ æ•°æ®æ¨¡å‹å®šä¹‰                                       â”‚   â”‚
â”‚  â”‚  â€¢ ç±»å‹å®‰å…¨æŸ¥è¯¢                                       â”‚   â”‚
â”‚  â”‚  â€¢ æ•°æ®åº“è¿æ¥ç®¡ç†                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ TCP/IP
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PostgreSQL æ•°æ®åº“                          â”‚
â”‚  â€¢ users è¡¨ (ç”¨æˆ·ä¿¡æ¯)                                        â”‚
â”‚  â€¢ notes è¡¨ (ç¬”è®°æ•°æ®)                                        â”‚
â”‚  â€¢ notebooks è¡¨ (ç¬”è®°æœ¬)                                      â”‚
â”‚  â€¢ tags è¡¨ (æ ‡ç­¾)                                            â”‚
â”‚  â€¢ note_tags è¡¨ (ç¬”è®°-æ ‡ç­¾å…³è”)                               â”‚
â”‚  â€¢ sessions è¡¨ (ä¼šè¯ç®¡ç†)                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ¶æ„ç‰¹ç‚¹

**å‰åç«¯ä¸€ä½“åŒ– (Monolithic)**
- å•ä¸€ä»£ç åº“ï¼Œä¾¿äºç»´æŠ¤
- å…±äº«ç±»å‹å®šä¹‰ï¼Œç±»å‹å®‰å…¨
- ç»Ÿä¸€çš„æ„å»ºå’Œéƒ¨ç½²æµç¨‹
- å‡å°‘ç½‘ç»œå¾€è¿”ï¼Œæå‡æ€§èƒ½

**æœåŠ¡ç«¯æ¸²æŸ“ + å®¢æˆ·ç«¯äº¤äº’**
- é¦–å± SSRï¼Œæå‡ SEO å’Œé¦–å±åŠ è½½é€Ÿåº¦
- åç»­äº¤äº’ CSRï¼Œæä¾›æµç•…ä½“éªŒ
- React Server Components å‡å°‘å®¢æˆ·ç«¯ JS

**æ¸è¿›å¼å¢å¼º**
- æ ¸å¿ƒåŠŸèƒ½ä¼˜å…ˆ
- åŸºäºç‰¹æ€§æ£€æµ‹çš„åŠŸèƒ½å¯ç”¨
- è‰¯å¥½çš„é™çº§ç­–ç•¥

---

## 2. æŠ€æœ¯æ ˆè¯¦è§£

### 2.1 å‰ç«¯æŠ€æœ¯æ ˆ

#### **æ ¸å¿ƒæ¡†æ¶**

**Next.js 14.x**
- **é€‰æ‹©ç†ç”±**: 
  - æ–‡ä»¶ç³»ç»Ÿè·¯ç”±ï¼Œç®€åŒ–è·¯ç”±é…ç½®
  - App Router æä¾›å¼ºå¤§çš„å¸ƒå±€å’ŒåŠ è½½çŠ¶æ€ç®¡ç†
  - å†…ç½®å›¾ç‰‡ä¼˜åŒ–ã€å­—ä½“ä¼˜åŒ–
  - ä¼˜ç§€çš„å¼€å‘ä½“éªŒå’Œæ€§èƒ½
- **ä½¿ç”¨åœºæ™¯**: æ•´ä¸ªåº”ç”¨çš„åŸºç¡€æ¡†æ¶

**React 18.x**
- **é€‰æ‹©ç†ç”±**: 
  - ç»„ä»¶åŒ–å¼€å‘ï¼Œä»£ç å¤ç”¨æ€§é«˜
  - ä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿ
  - Server Components æå‡æ€§èƒ½
- **ä½¿ç”¨åœºæ™¯**: UI ç»„ä»¶å¼€å‘

**TypeScript 5.x**
- **é€‰æ‹©ç†ç”±**: 
  - ç±»å‹å®‰å…¨ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯
  - æ›´å¥½çš„ IDE æ”¯æŒ
  - æå‡ä»£ç å¯ç»´æŠ¤æ€§
- **ä½¿ç”¨åœºæ™¯**: æ‰€æœ‰ä»£ç æ–‡ä»¶

#### **UI å’Œæ ·å¼**

**Tailwind CSS 3.x**
- **é€‰æ‹©ç†ç”±**: 
  - å®ç”¨ä¼˜å…ˆçš„ CSS æ¡†æ¶
  - å¿«é€Ÿå¼€å‘ï¼Œæ— éœ€å†™ CSS æ–‡ä»¶
  - ä¼˜ç§€çš„å“åº”å¼è®¾è®¡æ”¯æŒ
  - ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨æ¸…é™¤æœªä½¿ç”¨çš„æ ·å¼
- **ä½¿ç”¨åœºæ™¯**: æ‰€æœ‰æ ·å¼éœ€æ±‚

**shadcn/ui**
- **é€‰æ‹©ç†ç”±**: 
  - åŸºäº Radix UI çš„é«˜è´¨é‡ç»„ä»¶
  - å®Œå…¨å¯å®šåˆ¶
  - æ— éœ€å®‰è£…ä¾èµ–ï¼Œç›´æ¥å¤åˆ¶åˆ°é¡¹ç›®
  - ä¸ Tailwind CSS å®Œç¾é›†æˆ
- **ä½¿ç”¨åœºæ™¯**: Buttonã€Dialogã€Input ç­‰åŸºç¡€ç»„ä»¶

#### **Markdown æ”¯æŒ**

**vditor**
- **é€‰æ‹©ç†ç”±**: 
  - åŠŸèƒ½ä¸°å¯Œçš„ Markdown ç¼–è¾‘å™¨
  - å†…ç½®åˆ†å±é¢„è§ˆæ¨¡å¼ï¼ˆsv æ¨¡å¼ï¼‰ï¼Œç¼–è¾‘ä¸é¢„è§ˆåŒæ­¥
  - æ”¯æŒä»£ç é«˜äº®ï¼ˆ100+ ç¼–ç¨‹è¯­è¨€ï¼Œæ”¯æŒè¡Œå·ï¼‰
  - æ”¯æŒæ•°å­¦å…¬å¼æ¸²æŸ“ï¼ˆKaTeXï¼‰
  - æ”¯æŒç›®å½•ç”Ÿæˆï¼ˆTOCï¼‰ã€è„šæ³¨ã€GFM ç­‰ç‰¹æ€§
  - ä¸°å¯Œçš„å·¥å…·æ å’Œå¿«æ·é”®
  - ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒå’Œæ€§èƒ½
- **ä½¿ç”¨åœºæ™¯**: Markdown ç¼–è¾‘å™¨ï¼ˆä¸»è¦ç¼–è¾‘åœºæ™¯ï¼‰

**react-markdown**ï¼ˆå¯é€‰ï¼Œç”¨äºå…¶ä»–é¢„è§ˆåœºæ™¯ï¼‰
- **é€‰æ‹©ç†ç”±**: 
  - React ç”Ÿæ€ä¸‹æµè¡Œçš„ Markdown æ¸²æŸ“åº“
  - æ”¯æŒè‡ªå®šä¹‰ç»„ä»¶æ˜ å°„
  - å®‰å…¨çš„ HTML æ¸²æŸ“
- **ä½¿ç”¨åœºæ™¯**: ç¬”è®°åˆ—è¡¨é¢„è§ˆç­‰å…¶ä»–åœºæ™¯

**react-syntax-highlighter**ï¼ˆå¯é€‰ï¼Œç”¨äº react-markdown çš„ä»£ç é«˜äº®ï¼‰
- **é€‰æ‹©ç†ç”±**: 
  - æ”¯æŒ 100+ ç¼–ç¨‹è¯­è¨€
  - å¤šç§é«˜äº®ä¸»é¢˜
  - è½»é‡çº§ï¼ŒæŒ‰éœ€åŠ è½½
- **ä½¿ç”¨åœºæ™¯**: é…åˆ react-markdown ä½¿ç”¨ï¼ˆä»…åœ¨é Vditor åœºæ™¯ï¼‰

#### **è¡¨å•å’ŒéªŒè¯**

**React Hook Form**
- **é€‰æ‹©ç†ç”±**: 
  - æ€§èƒ½ä¼˜ç§€ï¼ˆå‡å°‘é‡æ¸²æŸ“ï¼‰
  - API ç®€æ´
  - ä¸ Zod é›†æˆè‰¯å¥½
- **ä½¿ç”¨åœºæ™¯**: ç™»å½•ã€æ³¨å†Œã€ç¼–è¾‘è¡¨å•

**Zod**
- **é€‰æ‹©ç†ç”±**: 
  - TypeScript-first çš„æ¨¡å¼éªŒè¯åº“
  - ç±»å‹æ¨å¯¼èƒ½åŠ›å¼º
  - å‰åç«¯å…±äº«éªŒè¯è§„åˆ™
- **ä½¿ç”¨åœºæ™¯**: è¡¨å•éªŒè¯ã€API å‚æ•°éªŒè¯

#### **çŠ¶æ€ç®¡ç†**

**React Context**
- **é€‰æ‹©ç†ç”±**: 
  - React å†…ç½®ï¼Œæ— éœ€é¢å¤–ä¾èµ–
  - é€‚åˆç®€å•çš„çŠ¶æ€å…±äº«
- **ä½¿ç”¨åœºæ™¯**: ç”¨æˆ·è®¤è¯çŠ¶æ€ã€ä¸»é¢˜åˆ‡æ¢

**Zustand (å¯é€‰)**
- **é€‰æ‹©ç†ç”±**: 
  - æç®€çš„çŠ¶æ€ç®¡ç†åº“
  - æ— éœ€ Provider åŒ…è£¹
  - TypeScript æ”¯æŒå¥½
- **ä½¿ç”¨åœºæ™¯**: å¤æ‚çš„å®¢æˆ·ç«¯çŠ¶æ€ï¼ˆå¦‚éœ€è¦ï¼‰

### 2.2 åç«¯æŠ€æœ¯æ ˆ

#### **è¿è¡Œç¯å¢ƒ**

**Node.js 18.x+**
- **é€‰æ‹©ç†ç”±**: 
  - Next.js çš„è¿è¡ŒåŸºç¡€
  - ä¸°å¯Œçš„ npm ç”Ÿæ€
  - è‰¯å¥½çš„æ€§èƒ½
- **ä½¿ç”¨åœºæ™¯**: æœåŠ¡ç«¯è¿è¡Œæ—¶

**Next.js API Routes / Route Handlers**
- **é€‰æ‹©ç†ç”±**: 
  - ä¸å‰ç«¯åŒæ„ï¼Œæ— éœ€å•ç‹¬éƒ¨ç½²
  - æ”¯æŒä¸­é—´ä»¶
  - ç±»å‹å®‰å…¨çš„ API å¼€å‘
- **ä½¿ç”¨åœºæ™¯**: æ‰€æœ‰åç«¯ API

#### **è®¤è¯**

**NextAuth.js v5 (Auth.js)**
- **é€‰æ‹©ç†ç”±**: 
  - Next.js å®˜æ–¹æ¨èçš„è®¤è¯æ–¹æ¡ˆ
  - æ”¯æŒå¤šç§è®¤è¯æ–¹å¼
  - å†…ç½®ä¼šè¯ç®¡ç†
  - å®‰å…¨æ€§é«˜ï¼ˆCSRF ä¿æŠ¤ç­‰ï¼‰
- **ä½¿ç”¨åœºæ™¯**: ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ä¼šè¯ç®¡ç†

**bcrypt**
- **é€‰æ‹©ç†ç”±**: 
  - ä¸šç•Œæ ‡å‡†çš„å¯†ç å“ˆå¸Œç®—æ³•
  - é˜²å½©è™¹è¡¨æ”»å‡»
  - å¯è°ƒèŠ‚çš„è®¡ç®—æˆæœ¬
- **ä½¿ç”¨åœºæ™¯**: å¯†ç åŠ å¯†å­˜å‚¨

#### **æ•°æ®åº“**

**PostgreSQL 14+**
- **é€‰æ‹©ç†ç”±**: 
  - åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒå¤æ‚æŸ¥è¯¢
  - ACID ç‰¹æ€§ï¼Œæ•°æ®å¯é 
  - å¼€æºå…è´¹ï¼Œç¤¾åŒºæ´»è·ƒ
  - æ”¯æŒ JSONã€å…¨æ–‡æœç´¢ç­‰é«˜çº§ç‰¹æ€§
- **ä½¿ç”¨åœºæ™¯**: ä¸»æ•°æ®åº“

**Prisma 5.x**
- **é€‰æ‹©ç†ç”±**: 
  - ç±»å‹å®‰å…¨çš„ ORM
  - è‡ªåŠ¨ç”Ÿæˆæ•°æ®åº“è¿ç§»
  - æ”¯æŒå¤šç§æ•°æ®åº“ï¼ˆä¾¿äºè¿ç§»ï¼‰
  - ä¼˜ç§€çš„å¼€å‘ä½“éªŒï¼ˆè‡ªåŠ¨è¡¥å…¨ã€æ–‡æ¡£ï¼‰
  - å†…ç½®è¿æ¥æ± ç®¡ç†
- **ä½¿ç”¨åœºæ™¯**: æ•°æ®åº“æ“ä½œ

### 2.3 å¼€å‘å·¥å…·

**ESLint**
- ä»£ç è´¨é‡æ£€æŸ¥
- ç»Ÿä¸€ä»£ç é£æ ¼

**Prettier**
- ä»£ç æ ¼å¼åŒ–
- ä¸ ESLint é›†æˆ

**Husky**
- Git hooks ç®¡ç†
- æäº¤å‰è‡ªåŠ¨æ£€æŸ¥

**TypeScript**
- ç±»å‹æ£€æŸ¥
- ç¼–è¯‘æ—¶é”™è¯¯æ£€æµ‹

---

## 3. é¡¹ç›®ç›®å½•ç»“æ„

```
mars-notes/
â”œâ”€â”€ docs/                          # ğŸ“š é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ PRD.md                    # äº§å“éœ€æ±‚æ–‡æ¡£
â”‚   â”œâ”€â”€ ARCHITECTURE.md           # æ¶æ„è®¾è®¡æ–‡æ¡£ (æœ¬æ–‡æ¡£)
â”‚   â”œâ”€â”€ DATABASE.md               # æ•°æ®åº“è®¾è®¡æ–‡æ¡£
â”‚   â”œâ”€â”€ API.md                    # API æ¥å£æ–‡æ¡£
â”‚   â””â”€â”€ DEPLOYMENT.md             # éƒ¨ç½²è¿ç»´æ–‡æ¡£
â”‚
â”œâ”€â”€ prisma/                        # ğŸ—„ï¸ æ•°æ®åº“ç›¸å…³
â”‚   â”œâ”€â”€ schema.prisma             # Prisma æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ migrations/               # æ•°æ®åº“è¿ç§»å†å²
â”‚   â”‚   â””â”€â”€ 20250104_init/       # åˆå§‹è¿ç§»
â”‚   â””â”€â”€ seed.ts                   # ç§å­æ•°æ® (å¯é€‰)
â”‚
â”œâ”€â”€ public/                        # ğŸŒ é™æ€èµ„æº
â”‚   â”œâ”€â”€ favicon.ico               # ç½‘ç«™å›¾æ ‡
â”‚   â”œâ”€â”€ logo.svg                  # Logo å›¾æ ‡
â”‚   â””â”€â”€ images/                   # å›¾ç‰‡èµ„æº
â”‚
â”œâ”€â”€ src/                          # ğŸ’» æºä»£ç ç›®å½•
â”‚   â”‚
â”‚   â”œâ”€â”€ app/                      # ğŸ“± Next.js App Router
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ (auth)/              # ğŸ” è®¤è¯è·¯ç”±ç»„ (ä¸å½±å“ URL)
â”‚   â”‚   â”‚   â”œâ”€â”€ login/           # ç™»å½•é¡µ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ register/        # æ³¨å†Œé¡µ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx       # è®¤è¯é¡µé¢å¸ƒå±€
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ (dashboard)/         # ğŸ“Š ä¸»åº”ç”¨è·¯ç”±ç»„
â”‚   â”‚   â”‚   â”œâ”€â”€ notes/           # ç¬”è®°åˆ—è¡¨é¡µ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ loading.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ editor/          # ç¼–è¾‘å™¨é¡µ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ [id]/       # åŠ¨æ€è·¯ç”±
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ new/        # æ–°å»ºç¬”è®°
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx       # Dashboard å¸ƒå±€
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ api/                 # ğŸ”Œ API è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/            # è®¤è¯ç›¸å…³ API
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ register/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [...nextauth]/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ route.ts # NextAuth é…ç½®
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ notes/           # ç¬”è®°ç›¸å…³ API
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ route.ts     # GET åˆ—è¡¨, POST åˆ›å»º
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ [id]/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts # GET/PUT/DELETE å•ä¸ªç¬”è®°
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ search/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ route.ts # GET æœç´¢
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ notebooks/       # ç¬”è®°æœ¬ç›¸å…³ API
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ route.ts     # GET åˆ—è¡¨, POST åˆ›å»º
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ route.ts # GET/PUT/DELETE å•ä¸ªç¬”è®°æœ¬
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ tags/            # æ ‡ç­¾ç›¸å…³ API
â”‚   â”‚   â”‚       â”œâ”€â”€ route.ts     # GET åˆ—è¡¨, POST åˆ›å»º
â”‚   â”‚   â”‚       â””â”€â”€ [id]/
â”‚   â”‚   â”‚           â””â”€â”€ route.ts # GET/PUT/DELETE å•ä¸ªæ ‡ç­¾
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ layout.tsx           # æ ¹å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ page.tsx             # é¦–é¡µ (é‡å®šå‘åˆ° /notes)
â”‚   â”‚   â”œâ”€â”€ globals.css          # å…¨å±€æ ·å¼
â”‚   â”‚   â””â”€â”€ error.tsx            # é”™è¯¯é¡µé¢
â”‚   â”‚
â”‚   â”œâ”€â”€ components/               # ğŸ§© React ç»„ä»¶
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ui/                  # åŸºç¡€ UI ç»„ä»¶ (shadcn/ui)
â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ toast.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ auth/                # è®¤è¯ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ LoginForm.tsx    # ç™»å½•è¡¨å•
â”‚   â”‚   â”‚   â”œâ”€â”€ RegisterForm.tsx # æ³¨å†Œè¡¨å•
â”‚   â”‚   â”‚   â””â”€â”€ AuthGuard.tsx    # è·¯ç”±å®ˆå«
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ notes/               # ç¬”è®°ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ NoteCard.tsx     # ç¬”è®°å¡ç‰‡
â”‚   â”‚   â”‚   â”œâ”€â”€ NoteList.tsx     # ç¬”è®°åˆ—è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ NoteSearch.tsx   # æœç´¢æ¡†
â”‚   â”‚   â”‚   â””â”€â”€ DeleteDialog.tsx # åˆ é™¤ç¡®è®¤å¯¹è¯æ¡†
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ notebooks/           # ç¬”è®°æœ¬ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ NotebookList.tsx # ç¬”è®°æœ¬åˆ—è¡¨
â”‚   â”‚   â”‚   â””â”€â”€ NotebookDialog.tsx # ç¬”è®°æœ¬åˆ›å»º/ç¼–è¾‘å¯¹è¯æ¡†
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ tags/                # æ ‡ç­¾ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ TagList.tsx      # æ ‡ç­¾åˆ—è¡¨
â”‚   â”‚   â”‚   â””â”€â”€ TagSelector.tsx  # æ ‡ç­¾é€‰æ‹©å™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ editor/              # ç¼–è¾‘å™¨ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ MarkdownEditor.tsx # Markdown ç¼–è¾‘å™¨ï¼ˆä¸»ç»„ä»¶ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ VditorEditor.tsx    # Vditor ç¼–è¾‘å™¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ MarkdownPreview.tsx # Markdown é¢„è§ˆï¼ˆç”¨äºå…¶ä»–åœºæ™¯ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ AutoSaveIndicator.tsx # ä¿å­˜çŠ¶æ€æŒ‡ç¤ºå™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ layout/              # å¸ƒå±€ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ Header.tsx       # é¡¶éƒ¨å¯¼èˆª
â”‚   â”‚       â”œâ”€â”€ Sidebar.tsx      # ä¾§è¾¹æ 
â”‚   â”‚       â””â”€â”€ Footer.tsx       # é¡µè„š
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/                     # ğŸ› ï¸ å·¥å…·åº“å’Œé…ç½®
â”‚   â”‚   â”œâ”€â”€ prisma.ts            # Prisma å®¢æˆ·ç«¯å•ä¾‹
â”‚   â”‚   â”œâ”€â”€ auth.ts              # NextAuth é…ç½®
â”‚   â”‚   â”œâ”€â”€ auth-options.ts      # è®¤è¯é€‰é¡¹
â”‚   â”‚   â”œâ”€â”€ db.ts                # æ•°æ®åº“å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ utils.ts             # é€šç”¨å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ validations.ts       # Zod éªŒè¯æ¨¡å¼
â”‚   â”‚   â””â”€â”€ constants.ts         # å¸¸é‡å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                   # ğŸ“ TypeScript ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ index.ts             # ç±»å‹å¯¼å‡ºï¼ˆåŒ…å«æ‰€æœ‰ç±»å‹ï¼‰
â”‚   â”‚   â””â”€â”€ ... (ç”¨æˆ·ã€ç¬”è®°ã€ç¬”è®°æœ¬ã€æ ‡ç­¾ç­‰ç±»å‹å®šä¹‰)
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                   # ğŸª è‡ªå®šä¹‰ React Hooks
â”‚   â”‚   â”œâ”€â”€ useAuth.ts           # è®¤è¯ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ useNotes.ts          # ç¬”è®°æ•°æ®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ useAutoSave.ts       # è‡ªåŠ¨ä¿å­˜
â”‚   â”‚   â””â”€â”€ useDebounce.ts       # é˜²æŠ–
â”‚   â”‚
â”‚   â””â”€â”€ middleware.ts            # ğŸ”’ Next.js ä¸­é—´ä»¶ (è·¯ç”±ä¿æŠ¤)
â”‚
â”œâ”€â”€ .env                          # ğŸ” ç¯å¢ƒå˜é‡ (ä¸æäº¤åˆ° Git)
â”œâ”€â”€ .env.example                  # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ eslint.config.mjs            # ESLint é…ç½®
â”œâ”€â”€ .gitignore                   # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ .prettierrc                  # Prettier é…ç½®
â”œâ”€â”€ next.config.js               # Next.js é…ç½®
â”œâ”€â”€ package.json                 # é¡¹ç›®ä¾èµ–
â”œâ”€â”€ postcss.config.js            # PostCSS é…ç½®
â”œâ”€â”€ tailwind.config.ts           # Tailwind CSS é…ç½®
â”œâ”€â”€ tsconfig.json                # TypeScript é…ç½®
â””â”€â”€ README.md                    # é¡¹ç›®è¯´æ˜
```

### 3.1 ç›®å½•è®¾è®¡åŸåˆ™

**æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡**
- æ¯ä¸ªåŠŸèƒ½æ¨¡å—ç‹¬ç«‹ç›®å½•
- ç›¸å…³æ–‡ä»¶æ”¾åœ¨ä¸€èµ·
- ä¾¿äºå®šä½å’Œç»´æŠ¤

**åˆ†å±‚æ¸…æ™°**
- è¡¨ç°å±‚ (components)
- ä¸šåŠ¡é€»è¾‘å±‚ (hooks, lib)
- æ•°æ®è®¿é—®å±‚ (lib/prisma, api)

**å¯æ‰©å±•æ€§**
- ç»„ä»¶æŒ‰ç±»å‹åˆ†ç±»
- é¢„ç•™æ‰©å±•ç©ºé—´
- æ˜“äºæ·»åŠ æ–°åŠŸèƒ½

---

## 4. æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 4.1 è®¤è¯æ¨¡å—

#### **æ¨¡å—èŒè´£**
- ç”¨æˆ·æ³¨å†Œå’Œç™»å½•
- ä¼šè¯ç®¡ç†å’Œç»´æŠ¤
- è·¯ç”±æƒé™æ§åˆ¶
- å¯†ç åŠ å¯†å’ŒéªŒè¯

#### **æŠ€æœ¯å®ç°**

**NextAuth.js é…ç½®** (`src/lib/auth-options.ts`)
```typescript
import { NextAuthOptions } from "next-auth";
import CredentialsProvider from "next-auth/providers/credentials";
import { PrismaAdapter } from "@auth/prisma-adapter";
import bcrypt from "bcrypt";
import { prisma } from "./prisma";

export const authOptions: NextAuthOptions = {
  adapter: PrismaAdapter(prisma),
  providers: [
    CredentialsProvider({
      name: "Credentials",
      credentials: {
        email: { label: "Email", type: "email" },
        password: { label: "Password", type: "password" },
      },
      async authorize(credentials) {
        // éªŒè¯é€»è¾‘
        const user = await prisma.user.findUnique({
          where: { email: credentials.email },
        });
        if (user && await bcrypt.compare(credentials.password, user.password)) {
          return { id: user.id, email: user.email, name: user.name };
        }
        return null;
      },
    }),
  ],
  session: {
    strategy: "jwt",
    maxAge: 30 * 24 * 60 * 60, // 30 å¤©
  },
  pages: {
    signIn: "/login",
    signOut: "/login",
    error: "/login",
  },
};
```

**ä¸­é—´ä»¶ä¿æŠ¤** (`src/middleware.ts`)
```typescript
import { withAuth } from "next-auth/middleware";

export default withAuth({
  callbacks: {
    authorized({ req, token }) {
      // å¦‚æœè®¿é—® dashboardï¼Œéœ€è¦ç™»å½•
      if (req.nextUrl.pathname.startsWith("/notes")) {
        return !!token;
      }
      return true;
    },
  },
});

export const config = {
  matcher: ["/notes/:path*", "/editor/:path*"],
};
```

#### **ç»„ä»¶ç¤ºä¾‹**

**ç™»å½•è¡¨å•** (`src/components/auth/LoginForm.tsx`)
```typescript
"use client";

import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { z } from "zod";
import { signIn } from "next-auth/react";
import { useRouter } from "next/navigation";

const loginSchema = z.object({
  email: z.string().email("è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€"),
  password: z.string().min(8, "å¯†ç è‡³å°‘ 8 ä½"),
});

type LoginForm = z.infer<typeof loginSchema>;

export function LoginForm() {
  const router = useRouter();
  const { register, handleSubmit, formState: { errors } } = useForm<LoginForm>({
    resolver: zodResolver(loginSchema),
  });

  const onSubmit = async (data: LoginForm) => {
    const result = await signIn("credentials", {
      redirect: false,
      email: data.email,
      password: data.password,
    });

    if (result?.ok) {
      router.push("/notes");
    }
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      {/* è¡¨å•å®ç° */}
    </form>
  );
}
```

### 4.2 ç¬”è®°ç®¡ç†æ¨¡å—

#### **æ¨¡å—èŒè´£**
- ç¬”è®°çš„ CRUD æ“ä½œ
- ç¬”è®°åˆ—è¡¨å±•ç¤ºï¼ˆæ”¯æŒæŒ‰ç¬”è®°æœ¬ã€æ ‡ç­¾è¿‡æ»¤ï¼‰
- æœç´¢å’Œè¿‡æ»¤
- ç¬”è®°æœ¬åˆ†ç±»ç®¡ç†
- æ ‡ç­¾å…³è”ç®¡ç†
- æ•°æ®æŒä¹…åŒ–

#### **æ•°æ®æ¨¡å‹**

**Note ç±»å‹å®šä¹‰** (`src/types/index.ts`)
```typescript
export interface Note {
  id: string;
  userId: string;
  notebookId?: string | null;
  title: string;
  content: string;
  createdAt: Date;
  updatedAt: Date;
  notebook?: Notebook | null;
  tags?: Tag[];
}

export interface Notebook {
  id: string;
  userId: string;
  name: string;
  description?: string | null;
  color?: string | null;
  icon?: string | null;
  sortOrder: number;
  createdAt: Date;
  updatedAt: Date;
  _count?: {
    notes: number;
  };
}

export interface Tag {
  id: string;
  userId: string;
  name: string;
  color?: string | null;
  createdAt: Date;
  updatedAt: Date;
  _count?: {
    noteTags: number;
  };
}

export interface CreateNoteInput {
  title: string;
  content?: string;
  notebookId?: string | null;
  tagIds?: string[];
}

export interface UpdateNoteInput {
  title?: string;
  content?: string;
  notebookId?: string | null;
  tagIds?: string[];
}

export interface NoteQueryParams {
  search?: string;
  notebookId?: string;
  tagIds?: string[];
  sortBy?: 'updatedAt' | 'createdAt' | 'title';
  sortOrder?: 'asc' | 'desc';
  page?: number;
  limit?: number;
}
```

#### **API å®ç°**

**ç¬”è®°åˆ—è¡¨ API** (`src/app/api/notes/route.ts`)
```typescript
import { NextRequest, NextResponse } from "next/server";
import { getServerSession } from "next-auth";
import { authOptions } from "@/lib/auth-options";
import { prisma } from "@/lib/prisma";

// GET /api/notes - è·å–ç¬”è®°åˆ—è¡¨
export async function GET(req: NextRequest) {
  const session = await getServerSession(authOptions);
  if (!session) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }

  const notes = await prisma.note.findMany({
    where: { userId: session.user.id },
    orderBy: { updatedAt: "desc" },
    select: {
      id: true,
      title: true,
      content: true,
      createdAt: true,
      updatedAt: true,
    },
  });

  return NextResponse.json(notes);
}

// POST /api/notes - åˆ›å»ºæ–°ç¬”è®°
export async function POST(req: NextRequest) {
  const session = await getServerSession(authOptions);
  if (!session) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }

  const body = await req.json();
  const note = await prisma.note.create({
    data: {
      title: body.title || "æœªå‘½åç¬”è®°",
      content: body.content || "",
      userId: session.user.id,
    },
  });

  return NextResponse.json(note, { status: 201 });
}
```

**å•ä¸ªç¬”è®° API** (`src/app/api/notes/[id]/route.ts`)
```typescript
import { NextRequest, NextResponse } from "next/server";
import { getServerSession } from "next-auth";
import { authOptions } from "@/lib/auth-options";
import { prisma } from "@/lib/prisma";

// GET /api/notes/[id] - è·å–å•ä¸ªç¬”è®°
export async function GET(
  req: NextRequest,
  { params }: { params: { id: string } }
) {
  const session = await getServerSession(authOptions);
  if (!session) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }

  const note = await prisma.note.findUnique({
    where: { id: params.id, userId: session.user.id },
  });

  if (!note) {
    return NextResponse.json({ error: "Not found" }, { status: 404 });
  }

  return NextResponse.json(note);
}

// PUT /api/notes/[id] - æ›´æ–°ç¬”è®°
export async function PUT(
  req: NextRequest,
  { params }: { params: { id: string } }
) {
  const session = await getServerSession(authOptions);
  if (!session) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }

  const body = await req.json();
  const note = await prisma.note.update({
    where: { id: params.id, userId: session.user.id },
    data: {
      title: body.title,
      content: body.content,
    },
  });

  return NextResponse.json(note);
}

// DELETE /api/notes/[id] - åˆ é™¤ç¬”è®°
export async function DELETE(
  req: NextRequest,
  { params }: { params: { id: string } }
) {
  const session = await getServerSession(authOptions);
  if (!session) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }

  await prisma.note.delete({
    where: { id: params.id, userId: session.user.id },
  });

  return NextResponse.json({ success: true });
}
```

### 4.3 ç¼–è¾‘å™¨æ¨¡å—

#### **æ¨¡å—èŒè´£**
- Markdown ç¼–è¾‘ï¼ˆåŸºäº Vditorï¼‰
- åˆ†å±é¢„è§ˆï¼ˆç¼–è¾‘ä¸é¢„è§ˆåŒæ­¥ï¼‰
- è‡ªåŠ¨ä¿å­˜
- ä»£ç é«˜äº®ï¼ˆå†…ç½®ï¼‰
- æ•°å­¦å…¬å¼æ”¯æŒï¼ˆKaTeXï¼‰
- ç›®å½•ç”Ÿæˆï¼ˆTOCï¼‰

#### **ç»„ä»¶å®ç°**

**Markdown ç¼–è¾‘å™¨** (`src/components/editor/MarkdownEditor.tsx`)
```typescript
"use client";

import { useState, useEffect, useRef } from "react";
import { useRouter } from "next/navigation";
import { useDebounce } from "@/hooks/useDebounce";
import { AutoSaveIndicator } from "./AutoSaveIndicator";
import { VditorEditor } from "./VditorEditor";
// ... å…¶ä»–å¯¼å…¥

interface MarkdownEditorProps {
  noteId: string;
  initialTitle: string;
  initialContent: string;
  initialNotebookId?: string;
  initialTags?: Tag[];
}

export function MarkdownEditor({
  noteId,
  initialTitle,
  initialContent,
  initialNotebookId,
  initialTags = [],
}: MarkdownEditorProps) {
  const [title, setTitle] = useState(initialTitle);
  const [content, setContent] = useState(initialContent);
  const [saving, setSaving] = useState(false);
  const [lastSaved, setLastSaved] = useState<Date | null>(null);

  // é˜²æŠ–ï¼Œ1 ç§’åè‡ªåŠ¨ä¿å­˜
  const debouncedContent = useDebounce(content, 1000);
  const debouncedTitle = useDebounce(title, 1000);

  useEffect(() => {
    const saveNote = async () => {
      if (debouncedContent === initialContent && debouncedTitle === initialTitle) {
        return;
      }

      setSaving(true);
      try {
        await fetch(`/api/notes/${noteId}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            title,
            content,
            notebookId: notebookId || null,
            tagIds,
          }),
        });
        setLastSaved(new Date());
      } catch (error) {
        console.error("ä¿å­˜å¤±è´¥:", error);
      } finally {
        setSaving(false);
      }
    };

    if (debouncedContent !== undefined || debouncedTitle !== undefined) {
      saveNote();
    }
  }, [debouncedContent, debouncedTitle]);

  return (
    <div className="flex h-[calc(100vh-4rem)] flex-col">
      {/* å·¥å…·æ  */}
      <div className="border-b">
        {/* æ ‡é¢˜è¾“å…¥ã€ç¬”è®°æœ¬é€‰æ‹©ã€æ ‡ç­¾é€‰æ‹©ç­‰ */}
      </div>

      {/* ç¼–è¾‘å™¨ - Vditor å†…ç½®åˆ†å±é¢„è§ˆåŠŸèƒ½ */}
      <div className="flex flex-1 overflow-hidden flex-col">
        <div className="flex-1 overflow-hidden">
          <VditorEditor content={content} onContentChange={setContent} />
        </div>
        <AutoSaveIndicator saving={saving} lastSaved={lastSaved} />
      </div>
    </div>
  );
}
```

**Vditor ç¼–è¾‘å™¨ç»„ä»¶** (`src/components/editor/VditorEditor.tsx`)
```typescript
"use client";

import { useEffect, useRef, useState } from "react";
import Vditor from "vditor";
import "vditor/dist/index.css";

interface VditorEditorProps {
  content: string;
  onContentChange: (content: string) => void;
}

export function VditorEditor({ content, onContentChange }: VditorEditorProps) {
  const [vd, setVd] = useState<Vditor>();
  const containerRef = useRef<HTMLDivElement>(null);
  const contentRef = useRef<string>(content);
  const onChangeRef = useRef(onContentChange);
  const isInitializedRef = useRef(false);

  // åˆå§‹åŒ– Vditor
  useEffect(() => {
    if (!containerRef.current || isInitializedRef.current) return;

    contentRef.current = content;

    const vditor = new Vditor("vditor", {
      height: "100%",
      mode: "sv", // åˆ†å±é¢„è§ˆæ¨¡å¼
      preview: {
        delay: 300,
        hljs: {
          enable: true,
          style: "github",
          lineNumber: true,
        },
        markdown: {
          toc: true,
          footnotes: true,
          autoSpace: true,
          fixTermTypo: true,
        },
        math: {
          engine: "KaTeX",
        },
      },
      input: (value: string) => {
        if (value !== contentRef.current) {
          contentRef.current = value;
          onChangeRef.current(value);
        }
      },
      toolbar: [
        "headings", "bold", "italic", "strike", "|",
        "line", "quote", "list", "ordered-list", "check", "|",
        "code", "inline-code", "|",
        "link", "table", "|",
        "undo", "redo", "|",
        "fullscreen", "edit-mode", "preview-mode", "both", "|",
        "outline", "help",
      ],
      cache: {
        enable: false, // ç¦ç”¨ç¼“å­˜ï¼Œå› ä¸ºæˆ‘ä»¬è‡ªå·±ç®¡ç†å†…å®¹
      },
      after: () => {
        if (contentRef.current) {
          vditor.setValue(contentRef.current);
        }
        setVd(vditor);
        isInitializedRef.current = true;
      },
    });

    return () => {
      isInitializedRef.current = false;
    };
  }, []);

  // åŒæ­¥å¤–éƒ¨å†…å®¹å˜åŒ–åˆ°ç¼–è¾‘å™¨
  useEffect(() => {
    if (vd && content !== contentRef.current) {
      const currentValue = vd.getValue();
      if (currentValue !== content) {
        contentRef.current = content;
        vd.setValue(content);
      }
    }
  }, [content, vd]);

  return (
    <div ref={containerRef} className="vditor-container h-full w-full">
      <div id="vditor" className="h-full w-full" />
    </div>
  );
}
```

**Markdown é¢„è§ˆ** (`src/components/editor/MarkdownPreview.tsx`)
> æ³¨æ„ï¼šæ­¤ç»„ä»¶ä¸»è¦ç”¨äºç¬”è®°åˆ—è¡¨é¢„è§ˆç­‰å…¶ä»–åœºæ™¯ï¼Œç¼–è¾‘å™¨å·²ä½¿ç”¨ Vditor å†…ç½®é¢„è§ˆåŠŸèƒ½
```typescript
"use client";

import ReactMarkdown from "react-markdown";
import { Prism as SyntaxHighlighter } from "react-syntax-highlighter";
import { vscDarkPlus } from "react-syntax-highlighter/dist/esm/styles/prism";
import remarkGfm from "remark-gfm";

interface MarkdownPreviewProps {
  content: string;
}

export function MarkdownPreview({ content }: MarkdownPreviewProps) {
  return (
    <div className="markdown-body prose prose-slate max-w-none p-3 sm:p-6">
      <ReactMarkdown
        remarkPlugins={[remarkGfm]}
        components={{
          code({ node, inline, className, children, ...props }: any) {
            const match = /language-(\w+)/.exec(className || "");
            return !inline && match ? (
              <SyntaxHighlighter
                style={vscDarkPlus}
                language={match[1]}
                PreTag="div"
                {...props}
              >
                {String(children).replace(/\n$/, "")}
              </SyntaxHighlighter>
            ) : (
              <code className={className} {...props}>
                {children}
              </code>
            );
          },
        }}
      >
        {content || "*å¼€å§‹ç¼–å†™ä½ çš„ç¬”è®°...*"}
      </ReactMarkdown>
    </div>
  );
}
```

### 4.4 æœç´¢æ¨¡å—

#### **æœç´¢ API** (`src/app/api/notes/search/route.ts`)
```typescript
import { NextRequest, NextResponse } from "next/server";
import { getServerSession } from "next-auth";
import { authOptions } from "@/lib/auth-options";
import { prisma } from "@/lib/prisma";

// GET /api/notes/search?q=keyword
export async function GET(req: NextRequest) {
  const session = await getServerSession(authOptions);
  if (!session) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }

  const searchParams = req.nextUrl.searchParams;
  const query = searchParams.get("q") || "";

  if (!query) {
    return NextResponse.json([]);
  }

  const notes = await prisma.note.findMany({
    where: {
      userId: session.user.id,
      OR: [
        { title: { contains: query, mode: "insensitive" } },
        { content: { contains: query, mode: "insensitive" } },
      ],
    },
    orderBy: { updatedAt: "desc" },
  });

  return NextResponse.json(notes);
}
```

### 4.5 ç¬”è®°æœ¬ç®¡ç†æ¨¡å—

#### **æ¨¡å—èŒè´£**
- ç¬”è®°æœ¬çš„ CRUD æ“ä½œ
- ç¬”è®°æœ¬åˆ—è¡¨å±•ç¤ºå’Œæ’åº
- ç¬”è®°æœ¬ä¸ç¬”è®°çš„å…³è”ç®¡ç†
- ç¬”è®°æ•°é‡ç»Ÿè®¡

#### **API å®ç°ç¤ºä¾‹**

**ç¬”è®°æœ¬åˆ—è¡¨ API** (`src/app/api/notebooks/route.ts`)
```typescript
import { NextRequest, NextResponse } from "next/server";
import { auth } from "@/lib/auth";
import { prisma } from "@/lib/prisma";

// GET /api/notebooks - è·å–ç¬”è®°æœ¬åˆ—è¡¨
export async function GET(request: NextRequest) {
  const session = await auth();
  if (!session?.user?.id) {
    return NextResponse.json({ error: "æœªæˆæƒ" }, { status: 401 });
  }

  const notebooks = await prisma.notebook.findMany({
    where: { userId: session.user.id },
    include: {
      _count: {
        select: { notes: true },
      },
    },
    orderBy: [{ sortOrder: "asc" }, { createdAt: "desc" }],
  });

  return NextResponse.json({ data: notebooks });
}

// POST /api/notebooks - åˆ›å»ºç¬”è®°æœ¬
export async function POST(request: NextRequest) {
  const session = await auth();
  if (!session?.user?.id) {
    return NextResponse.json({ error: "æœªæˆæƒ" }, { status: 401 });
  }

  const body = await request.json();
  const { name, description, color, icon } = body;

  // è·å–å½“å‰æœ€å¤§çš„ sortOrder
  const maxSortOrder = await prisma.notebook.findFirst({
    where: { userId: session.user.id },
    orderBy: { sortOrder: "desc" },
    select: { sortOrder: true },
  });

  const notebook = await prisma.notebook.create({
    data: {
      userId: session.user.id,
      name,
      description,
      color,
      icon,
      sortOrder: (maxSortOrder?.sortOrder ?? -1) + 1,
    },
    include: {
      _count: {
        select: { notes: true },
      },
    },
  });

  return NextResponse.json({ data: notebook }, { status: 201 });
}
```

### 4.6 æ ‡ç­¾ç®¡ç†æ¨¡å—

#### **æ¨¡å—èŒè´£**
- æ ‡ç­¾çš„ CRUD æ“ä½œ
- æ ‡ç­¾åˆ—è¡¨å±•ç¤º
- æ ‡ç­¾ä¸ç¬”è®°çš„å¤šå¯¹å¤šå…³è”
- æ ‡ç­¾ä½¿ç”¨ç»Ÿè®¡

#### **API å®ç°ç¤ºä¾‹**

**æ ‡ç­¾åˆ—è¡¨ API** (`src/app/api/tags/route.ts`)
```typescript
import { NextRequest, NextResponse } from "next/server";
import { auth } from "@/lib/auth";
import { prisma } from "@/lib/prisma";

// GET /api/tags - è·å–æ ‡ç­¾åˆ—è¡¨
export async function GET(request: NextRequest) {
  const session = await auth();
  if (!session?.user?.id) {
    return NextResponse.json({ error: "æœªæˆæƒ" }, { status: 401 });
  }

  const tags = await prisma.tag.findMany({
    where: { userId: session.user.id },
    include: {
      _count: {
        select: { notes: true },
      },
    },
    orderBy: { createdAt: "desc" },
  });

  return NextResponse.json({ data: tags });
}

// POST /api/tags - åˆ›å»ºæ ‡ç­¾
export async function POST(request: NextRequest) {
  const session = await auth();
  if (!session?.user?.id) {
    return NextResponse.json({ error: "æœªæˆæƒ" }, { status: 401 });
  }

  const body = await request.json();
  const { name, color } = body;

  try {
    const tag = await prisma.tag.create({
      data: {
        userId: session.user.id,
        name,
        color,
      },
      include: {
        _count: {
          select: { notes: true },
        },
      },
    });

    return NextResponse.json({ data: tag }, { status: 201 });
  } catch (error: any) {
    // å¤„ç†å”¯ä¸€æ€§çº¦æŸé”™è¯¯
    if (error.code === "P2002") {
      return NextResponse.json(
        { error: "æ ‡ç­¾åç§°å·²å­˜åœ¨" },
        { status: 400 }
      );
    }
    throw error;
  }
}
```

---

## 5. æ•°æ®æµè®¾è®¡

### 5.1 è®¤è¯æµç¨‹

```
ç”¨æˆ·æäº¤ç™»å½•è¡¨å•
      â”‚
      â–¼
å®¢æˆ·ç«¯éªŒè¯ (Zod)
      â”‚
      â–¼
å‘é€ POST /api/auth/signin
      â”‚
      â–¼
NextAuth.js å¤„ç†
      â”‚
      â”œâ”€â†’ æŸ¥è¯¢æ•°æ®åº“ç”¨æˆ·
      â”‚
      â”œâ”€â†’ éªŒè¯å¯†ç  (bcrypt)
      â”‚
      â”œâ”€â†’ ç”Ÿæˆ JWT Token
      â”‚
      â””â”€â†’ è®¾ç½® HTTP-Only Cookie
            â”‚
            â–¼
      è¿”å›è®¤è¯ç»“æœ
            â”‚
            â”œâ”€â†’ æˆåŠŸ: è·³è½¬åˆ° /notes
            â”‚
            â””â”€â†’ å¤±è´¥: æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
```

### 5.2 ç¬”è®°ä¿å­˜æµç¨‹

```
ç”¨æˆ·ç¼–è¾‘ç¬”è®°å†…å®¹
      â”‚
      â–¼
è§¦å‘ onChange äº‹ä»¶
      â”‚
      â–¼
æ›´æ–°æœ¬åœ° State
      â”‚
      â–¼
é˜²æŠ–å»¶è¿Ÿ (2ç§’)
      â”‚
      â–¼
å‘é€ PUT /api/notes/[id]
      â”‚
      â”œâ”€â†’ éªŒè¯ç”¨æˆ·èº«ä»½
      â”‚
      â”œâ”€â†’ éªŒè¯ç¬”è®°æ‰€æœ‰æƒ
      â”‚
      â””â”€â†’ æ›´æ–°æ•°æ®åº“
            â”‚
            â”œâ”€â†’ æˆåŠŸ: æ›´æ–°ä¿å­˜çŠ¶æ€
            â”‚
            â””â”€â†’ å¤±è´¥: é‡è¯•æˆ–æç¤ºé”™è¯¯
```

### 5.3 ç¬”è®°åˆ—è¡¨åŠ è½½æµç¨‹

```
ç”¨æˆ·è®¿é—® /notes
      â”‚
      â–¼
Server Component æ¸²æŸ“
      â”‚
      â”œâ”€â†’ éªŒè¯ä¼šè¯ (middleware)
      â”‚
      â”œâ”€â†’ æŸ¥è¯¢æ•°æ®åº“
      â”‚
      â””â”€â†’ ç”Ÿæˆ HTML
            â”‚
            â–¼
      è¿”å›å®Œæ•´é¡µé¢
            â”‚
            â–¼
      å®¢æˆ·ç«¯æ°´åˆ (Hydration)
            â”‚
            â–¼
      äº¤äº’åŠŸèƒ½æ¿€æ´»
```

---

## 6. å®‰å…¨æ¶æ„

### 6.1 è®¤è¯ä¸æˆæƒ

**å¤šå±‚é˜²æŠ¤**
```
è¯·æ±‚ â†’ Middleware â†’ API Handler â†’ Database
        â†“              â†“              â†“
    ä¼šè¯æ£€æŸ¥      ç”¨æˆ·éªŒè¯      æƒé™æ§åˆ¶
```

**å…·ä½“æªæ–½**
1. **Middleware å±‚**: æ£€æŸ¥å—ä¿æŠ¤è·¯ç”±çš„ä¼šè¯
2. **API å±‚**: éªŒè¯ç”¨æˆ·èº«ä»½å’Œæƒé™
3. **Database å±‚**: æŸ¥è¯¢æ—¶æ·»åŠ  userId è¿‡æ»¤

### 6.2 å¯†ç å®‰å…¨

**åŠ å¯†ç­–ç•¥**
```typescript
// æ³¨å†Œæ—¶åŠ å¯†
const hashedPassword = await bcrypt.hash(password, 10);

// ç™»å½•æ—¶éªŒè¯
const isValid = await bcrypt.compare(password, user.password);
```

**å¯†ç è¦æ±‚**
- æœ€å°‘ 8 ä½å­—ç¬¦
- åŒ…å«å­—æ¯å’Œæ•°å­—
- æ¨èåŒ…å«ç‰¹æ®Šå­—ç¬¦

### 6.3 ä¼šè¯å®‰å…¨

**JWT Token é…ç½®**
- HTTP-Only Cookieï¼ˆé˜² XSSï¼‰
- SameSite=Laxï¼ˆé˜² CSRFï¼‰
- Secure=trueï¼ˆä»… HTTPSï¼‰
- 30 å¤©è¿‡æœŸæ—¶é—´
- è‡ªåŠ¨åˆ·æ–°æœºåˆ¶

### 6.4 æ•°æ®å®‰å…¨

**SQL æ³¨å…¥é˜²æŠ¤**
- ä½¿ç”¨ Prisma å‚æ•°åŒ–æŸ¥è¯¢
- æ‰€æœ‰è¾“å…¥éƒ½ç»è¿‡ ORM å¤„ç†

**XSS é˜²æŠ¤**
- React è‡ªåŠ¨è½¬ä¹‰
- Markdown æ¸²æŸ“æ—¶è¿‡æ»¤å±é™©æ ‡ç­¾
- CSP (Content Security Policy)

**CSRF é˜²æŠ¤**
- NextAuth.js å†…ç½® CSRF Token
- SameSite Cookie å±æ€§

### 6.5 API å®‰å…¨

**è¯·æ±‚éªŒè¯**
```typescript
// ä½¿ç”¨ Zod éªŒè¯
const schema = z.object({
  title: z.string().min(1).max(200),
  content: z.string().max(100000),
});

const result = schema.safeParse(body);
if (!result.success) {
  return NextResponse.json(
    { error: result.error },
    { status: 400 }
  );
}
```

**é€Ÿç‡é™åˆ¶** (æœªæ¥å¯æ·»åŠ )
- é™åˆ¶ API è°ƒç”¨é¢‘ç‡
- é˜²æ­¢æš´åŠ›ç ´è§£

---

## 7. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 7.1 å‰ç«¯ä¼˜åŒ–

#### **Server Components**
- å¤§éƒ¨åˆ†é¡µé¢ä½¿ç”¨ Server Components
- å‡å°‘å®¢æˆ·ç«¯ JavaScript
- æå‡é¦–å±åŠ è½½é€Ÿåº¦

#### **ä»£ç åˆ†å‰²**
```typescript
// åŠ¨æ€å¯¼å…¥
const MarkdownEditor = dynamic(
  () => import("@/components/editor/MarkdownEditor"),
  { ssr: false, loading: () => <LoadingSpinner /> }
);
```

#### **å›¾ç‰‡ä¼˜åŒ–**
```typescript
import Image from "next/image";

<Image
  src="/logo.png"
  alt="Logo"
  width={200}
  height={100}
  priority
/>
```

#### **å­—ä½“ä¼˜åŒ–**
```typescript
// app/layout.tsx
import { Inter } from "next/font/google";

const inter = Inter({ subsets: ["latin"] });

export default function RootLayout({ children }) {
  return (
    <html lang="zh-CN" className={inter.className}>
      <body>{children}</body>
    </html>
  );
}
```

### 7.2 åç«¯ä¼˜åŒ–

#### **æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–**
```typescript
// ä½¿ç”¨ select å‡å°‘æ•°æ®ä¼ è¾“
const notes = await prisma.note.findMany({
  select: {
    id: true,
    title: true,
    updatedAt: true,
    // ä¸æŸ¥è¯¢ contentï¼ˆå¤§å­—æ®µï¼‰
  },
});

// ä½¿ç”¨ç´¢å¼•
// åœ¨ schema.prisma ä¸­å®šä¹‰
model Note {
  id        String   @id @default(cuid())
  userId    String
  title     String
  content   String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([userId, updatedAt]) // å¤åˆç´¢å¼•
}
```

#### **è¿æ¥æ± ç®¡ç†**
```typescript
// lib/prisma.ts
import { PrismaClient } from "@prisma/client";

const globalForPrisma = global as unknown as { prisma: PrismaClient };

export const prisma =
  globalForPrisma.prisma ||
  new PrismaClient({
    log: process.env.NODE_ENV === "development" ? ["query"] : [],
  });

if (process.env.NODE_ENV !== "production") {
  globalForPrisma.prisma = prisma;
}
```

#### **ç¼“å­˜ç­–ç•¥**
```typescript
// ä½¿ç”¨ Next.js ç¼“å­˜
export const revalidate = 60; // 60 ç§’

// æˆ–ä½¿ç”¨ unstable_cache
import { unstable_cache } from "next/cache";

const getCachedNotes = unstable_cache(
  async (userId) => await prisma.note.findMany({ where: { userId } }),
  ["user-notes"],
  { revalidate: 60 }
);
```

### 7.3 èµ„æºä¼˜åŒ–

**Tailwind CSS å‹ç¼©**
- ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨æ¸…é™¤æœªä½¿ç”¨çš„ç±»
- å‹ç¼©åé€šå¸¸ < 10KB

**JavaScript å‹ç¼©**
- Next.js è‡ªåŠ¨å‹ç¼©å’Œæ··æ·†
- ä½¿ç”¨ SWC ç¼–è¯‘å™¨ï¼ˆæ¯” Babel å¿«ï¼‰

**é™æ€èµ„æº CDN**
- éƒ¨ç½²åˆ° Vercel è‡ªåŠ¨ CDN
- å›¾ç‰‡ã€å­—ä½“ç­‰é™æ€èµ„æºè¾¹ç¼˜ç¼“å­˜

---

## 8. éƒ¨ç½²æ¶æ„

### 8.1 æ¨èéƒ¨ç½²æ–¹æ¡ˆ

**Vercel (æ¨è)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Vercel Edge Network           â”‚
â”‚  (å…¨çƒ CDN + è¾¹ç¼˜å‡½æ•°)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Next.js Application             â”‚
â”‚  â€¢ Server Components                    â”‚
â”‚  â€¢ API Routes                           â”‚
â”‚  â€¢ Static Assets                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      PostgreSQL Database                â”‚
â”‚  (Vercel Postgres / Supabase)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿**
- ä¸€é”®éƒ¨ç½²
- è‡ªåŠ¨ HTTPS
- å…¨çƒ CDN
- é›¶é…ç½®
- å…è´¹é¢åº¦å……è¶³

### 8.2 ç¯å¢ƒå˜é‡ç®¡ç†

```bash
# .env.example
# æ•°æ®åº“è¿æ¥
DATABASE_URL="postgresql://user:pass@host:5432/dbname"

# NextAuth.js
NEXTAUTH_URL="https://your-domain.com"
NEXTAUTH_SECRET="ç”Ÿæˆçš„éšæœºå­—ç¬¦ä¸²"

# åº”ç”¨é…ç½®
NODE_ENV="production"
```

### 8.4 CI/CD æµç¨‹

**GitHub Actions ç¤ºä¾‹**
```yaml
name: Deploy

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '18'
      
      - run: npm ci
      - run: npm run lint
      - run: npm run build
      
      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.ORG_ID }}
          vercel-project-id: ${{ secrets.PROJECT_ID }}
```

---

## 9. ç›‘æ§ä¸æ—¥å¿—

### 9.1 é”™è¯¯ç›‘æ§

**Sentry é›†æˆ**
```typescript
// next.config.js
const { withSentryConfig } = require("@sentry/nextjs");

module.exports = withSentryConfig({
  // Next.js config
});
```

### 9.2 æ€§èƒ½ç›‘æ§

**Vercel Analytics**
- è‡ªåŠ¨é›†æˆ
- å®æ—¶æ€§èƒ½æŒ‡æ ‡
- Web Vitals è¿½è¸ª

**è‡ªå®šä¹‰æ—¥å¿—**
```typescript
// lib/logger.ts
export const logger = {
  info: (message: string, meta?: any) => {
    console.log(`[INFO] ${message}`, meta);
  },
  error: (message: string, error?: Error) => {
    console.error(`[ERROR] ${message}`, error);
  },
};
```

---

## 10. æ‰©å±•æ€§è®¾è®¡

### 10.1 æ°´å¹³æ‰©å±•

- æ— çŠ¶æ€è®¾è®¡ï¼ˆä¼šè¯å­˜å‚¨åœ¨ JWTï¼‰
- æ•°æ®åº“è¿æ¥æ± 
- é™æ€èµ„æº CDN
- è´Ÿè½½å‡è¡¡å™¨ï¼ˆå¦‚éœ€ï¼‰

### 10.2 åŠŸèƒ½æ‰©å±•

**æ’ä»¶åŒ–è®¾è®¡**
- Markdown ç¼–è¾‘å™¨å¯æ›¿æ¢
- è®¤è¯æ–¹å¼å¯æ‰©å±•ï¼ˆOAuthï¼‰
- æ•°æ®åº“å¯è¿ç§»ï¼ˆMySQL/SQLiteï¼‰

**å·²å®ç°çš„æ¨¡å—**
- âœ… ç”¨æˆ·è®¤è¯æ¨¡å—ï¼ˆæ³¨å†Œã€ç™»å½•ã€ä¼šè¯ç®¡ç†ï¼‰
- âœ… ç¬”è®°ç®¡ç†æ¨¡å—ï¼ˆCRUDã€æœç´¢ã€è¿‡æ»¤ï¼‰
- âœ… ç¬”è®°æœ¬åŠŸèƒ½æ¨¡å—ï¼ˆåˆ†ç±»ç®¡ç†ã€æ’åºï¼‰
- âœ… æ ‡ç­¾ç³»ç»Ÿæ¨¡å—ï¼ˆå¤šå¯¹å¤šå…³è”ã€ç»Ÿè®¡ï¼‰
- âœ… Markdown ç¼–è¾‘å™¨ï¼ˆVditor åˆ†å±é¢„è§ˆã€ä»£ç é«˜äº®ã€æ•°å­¦å…¬å¼ã€TOCï¼‰
- âœ… è‡ªåŠ¨ä¿å­˜åŠŸèƒ½

**æœªæ¥å¯æ‰©å±•åŠŸèƒ½**
- ğŸ”„ ç¬”è®°åˆ†äº«åŠŸèƒ½ï¼ˆå…¬å¼€é“¾æ¥ã€æƒé™æ§åˆ¶ï¼‰
- ğŸ”„ å¤šäººåä½œåŠŸèƒ½ï¼ˆå®æ—¶ç¼–è¾‘ã€å†²çªè§£å†³ï¼‰
- ğŸ”„ é™„ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆå›¾ç‰‡ã€æ–‡ä»¶ï¼‰
- ğŸ”„ ç¬”è®°å¯¼å‡ºåŠŸèƒ½ï¼ˆPDFã€HTMLã€Markdownï¼‰
- ğŸ”„ ç¬”è®°æ¨¡æ¿åŠŸèƒ½
- ğŸ”„ AI è¾…åŠ©åŠŸèƒ½ï¼ˆè‡ªåŠ¨æ‘˜è¦ã€æ ‡ç­¾æ¨èï¼‰

---

## 11. å¼€å‘è§„èŒƒ

### 11.1 ä»£ç è§„èŒƒ

**TypeScript**
- ä¸¥æ ¼æ¨¡å¼
- æ˜¾å¼ç±»å‹å£°æ˜
- é¿å… any

**å‘½åè§„èŒƒ**
- ç»„ä»¶: PascalCase (e.g., `NoteCard`)
- å‡½æ•°: camelCase (e.g., `getNotes`)
- å¸¸é‡: UPPER_SNAKE_CASE (e.g., `API_BASE_URL`)
- ç±»å‹: PascalCase + Type/Interface åç¼€

**æ–‡ä»¶ç»„ç»‡**
- ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªç»„ä»¶
- ç›¸å…³æ–‡ä»¶æ”¾åœ¨åŒä¸€ç›®å½•
- ä½¿ç”¨ index.ts å¯¼å‡º

### 11.2 Git è§„èŒƒ

**Commit æ¶ˆæ¯**
```
feat: æ·»åŠ æ–°åŠŸèƒ½
fix: ä¿®å¤ bug
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼è°ƒæ•´
refactor: é‡æ„
test: æµ‹è¯•
chore: æ„å»ºå·¥å…·æˆ–è¾…åŠ©å·¥å…·å˜åŠ¨
```

**åˆ†æ”¯ç­–ç•¥**
- main: ç”Ÿäº§ç¯å¢ƒ
- develop: å¼€å‘ç¯å¢ƒ
- feature/*: åŠŸèƒ½åˆ†æ”¯
- hotfix/*: ç´§æ€¥ä¿®å¤

---

## 12. æ€»ç»“

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº† Mars-Notes ç³»ç»Ÿçš„æŠ€æœ¯æ¶æ„è®¾è®¡ï¼ˆv1.1ï¼‰ï¼Œæ¶µç›–äº†ä»å‰ç«¯åˆ°åç«¯ã€ä»å¼€å‘åˆ°éƒ¨ç½²çš„å„ä¸ªæ–¹é¢ã€‚

**æ ¸å¿ƒä¼˜åŠ¿**
- âœ… å‰åç«¯ä¸€ä½“åŒ–ï¼Œç®€åŒ–å¼€å‘å’Œéƒ¨ç½²
- âœ… ç±»å‹å®‰å…¨ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯
- âœ… æ€§èƒ½ä¼˜åŒ–ï¼Œæä¾›æµç•…ä½“éªŒ
- âœ… å®‰å…¨å¯é ï¼Œä¿æŠ¤ç”¨æˆ·æ•°æ®
- âœ… æ˜“äºæ‰©å±•ï¼Œæ”¯æŒæŒç»­è¿­ä»£
- âœ… æ¨¡å—åŒ–è®¾è®¡ï¼ŒåŠŸèƒ½æ¸…æ™°ç‹¬ç«‹

**å½“å‰åŠŸèƒ½çŠ¶æ€ (v1.2)**
- âœ… ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- âœ… ç¬”è®° CRUD å®Œæ•´åŠŸèƒ½
- âœ… ç¬”è®°æœ¬åˆ†ç±»ç®¡ç†
- âœ… æ ‡ç­¾ç³»ç»Ÿ
- âœ… é«˜çº§æœç´¢å’Œè¿‡æ»¤
- âœ… Markdown ç¼–è¾‘å™¨ï¼ˆVditor åˆ†å±é¢„è§ˆï¼‰
- âœ… è‡ªåŠ¨ä¿å­˜

**æŠ€æœ¯æ ˆæ€»è§ˆ**
- **å‰ç«¯**: Next.js 14 + React 18 + TypeScript + Tailwind CSS
- **åç«¯**: Next.js API Routes + NextAuth.js v5
- **æ•°æ®åº“**: PostgreSQL + Prisma ORM
- **éƒ¨ç½²**: Vercel (æ¨è) / VPS

**ä¸‹ä¸€æ­¥**
è¯·å‚è€ƒå…¶ä»–æ–‡æ¡£ç»§ç»­äº†è§£ï¼š
- [æ•°æ®åº“è®¾è®¡](./DATABASE.md) - è¯¦ç»†çš„æ•°æ®æ¨¡å‹å’Œå…³ç³»è®¾è®¡
- [API æ¥å£æ–‡æ¡£](./API.md) - å®Œæ•´çš„ API ç«¯ç‚¹å’Œä½¿ç”¨è¯´æ˜
- [éƒ¨ç½²æŒ‡å—](./DEPLOYMENT.md) - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æµç¨‹

---

**æ›´æ–°å†å²**
- **v1.2** (2025-01-27): ç¼–è¾‘å™¨å‡çº§ä¸º Vditorï¼Œæ”¯æŒåˆ†å±é¢„è§ˆã€æ•°å­¦å…¬å¼ã€TOC ç­‰åŠŸèƒ½
- **v1.1** (2025-11-04): æ–°å¢ç¬”è®°æœ¬å’Œæ ‡ç­¾åŠŸèƒ½
- **v1.0** (2025-11-04): åˆå§‹ç‰ˆæœ¬ï¼ŒåŒ…å«åŸºç¡€ç¬”è®°åŠŸèƒ½

**æ–‡æ¡£ç»´æŠ¤**
- æœ¬æ–‡æ¡£éšæŠ€æœ¯æ ˆå‡çº§æŒç»­æ›´æ–°
- é‡å¤§æ¶æ„å˜æ›´éœ€åŒæ­¥æ›´æ–°æ–‡æ¡£
- æ‰€æœ‰å¼€å‘è€…éƒ½åº”ç†Ÿæ‚‰æœ¬æ–‡æ¡£
- æ–°åŠŸèƒ½å¼€å‘å‰éœ€è¯„ä¼°æ¶æ„å½±å“

